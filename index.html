<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AGARI | Gateball MapÂ®</title>

  <!-- favicon -->
  <link rel="icon" href="public/favicon.ico" />

  <!-- MAPBOX -->
  <link
    href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css"
    rel="stylesheet"
  />
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>

  <style>
    body { margin: 0; font-family: "Noto Sans JP", system-ui, sans-serif; }
    #map { position: fixed; inset: 0; }

    .agari-marker {
      width: 50px;
      height: 50px;
      background-image: url("public/markers/agari-pin-10kb.png");
      background-size: contain;
      background-repeat: no-repeat;
      cursor: pointer;
      filter: drop-shadow(0 2px 3px rgba(0,0,0,0.25));
    }

    .agari-label {
      position: absolute;
      left: 42px;
      top: 50%;
      transform: translateY(-50%);
      padding: 4px 8px;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(4px);
      border-radius: 6px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      transition: opacity .2s ease;
      pointer-events: none;
    }

    /* ===== BOTTOM SHEET ===== */
    .sheet {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: #fff;
      border-radius: 20px 20px 0 0;
      padding: 14px 20px 20px;
      transform: translateY(100%);
      transition: transform .35s ease;
      box-shadow: 0 -10px 30px rgba(0,0,0,.15);
      z-index: 10;
    }
    .sheet-header {
      position: relative;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .sheet-header h2 {
      font-size: 20px;
      font-weight: 600;
      margin: 0;
    }
    .sheet.show { transform: translateY(0);
    }
    .sheet-handle {
      width: 40px; height: 4px;
      background: #ccc;
      margin: 0 auto 12px;
      border-radius: 2px;
    }
    /* ===== BADGES ===== */
    .sheet-badges {
      position: absolute;
      top: 0;
      right: 0;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      align-items: center;
    }
    .status-badge, .verified-badge, .unverified-badge {
      display: inline-block;
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 500;
    }
    .status-active { background:#e6f6ee;color:#0f7a4a; }
    .status-inactive { background:#fdecec;color:#a02a2a; }
    .verified-badge { background:#e8f8ef;color:#1e7f4f; }
    .unverified-badge { background:#f2f2f2;color:#666; }

        /* ===== ADDRESS ===== */
    .sheet-address {
      font-size: 13px;
      color: #666;
      line-height: 1.4;
      margin: 8px 0 16px;
    }
    
    /* ===== META GRID ===== */
    .sheet-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px 16px;
      margin-bottom: 18px;
    }
    
    .sheet-meta span {
      font-size: 12px;
      color: #999;
    }
    
    .sheet-meta strong {
      display: block;
      margin-top: 2px;
      font-size: 14px;
      font-weight: 500;
      color: #111;
    }
    
    /* ===== VERIFY LINK ===== */
    .sheet-verify {
      display: inline-block;
      margin-bottom: 18px;
      font-size: 13px;
      color: #6b21a8; /* ungu kaya Odoo */
      text-decoration: underline;
      align-items: center;
    }

    body.sheet-open #agari-global-cta-wrapper { opacity:.25 }
    #agari-global-cta-wrapper {
      position: fixed; top: 16px; right: 12px;
      pointer-events: none; z-index: 50;
    }

    /* ===== CTA ===== */
    .sheet-button {
      display: block;
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      background: #111;
      color: #fff;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
      text-decoration: none;
    }
    #agari-global-cta {
      pointer-events: auto;
      padding: 6px 12px;
      background: rgba(0,0,0,.35);
      color: #fff;
      border-radius: 999px;
      text-decoration: none;
      backdrop-filter: blur(6px);
      font-size: 12px;
    }
  </style>
</head>

<body>

<div id="agari-global-cta-wrapper">
  <a id="agari-global-cta" href="https://www.agari.id/submit-your-location" target="_blank">
    + Contribute
  </a>
</div>

<div id="map"></div>

<div id="agari-sheet" class="sheet">
  <div class="sheet-handle"></div>

  <div class="sheet-header">
    <h2 id="sheet-name"></h2>

    <div class="sheet-badges">
      <span id="sheet-status" class="status-badge"></span>
      <span id="sheet-verified" class="verified-badge">âœ” AGARI Verified</span>
      <span id="sheet-unverified" class="unverified-badge">Unverified</span>
    </div>
  </div>

  <p id="sheet-address" class="sheet-address"></p>

  <div class="sheet-meta">
    <div>
      <span>Community</span>
      <strong id="sheet-community"></strong>
    </div>
    <div>
      <span>Courts</span>
      <strong id="sheet-courts"></strong>
    </div>
    <div>
      <span>Surface</span>
      <strong id="sheet-surface"></strong>
    </div>
    <div>
      <span>Location</span>
      <strong id="sheet-location"></strong>
    </div>
  </div>

  <a id="sheet-verify-cta"
     class="sheet-verify"
     target="_blank"
     href="https://www.agari.id/submit-your-location">
     Help us verify this court
  </a>

  <a id="sheet-directions" class="sheet-button" target="_blank">
    Get Directions
  </a>
</div>


<script>
mapboxgl.accessToken = "pk.eyJ1IjoiYWdhcmlhcHBhcmVsIiwiYSI6ImNta2VmM2g4eDA2MnQzZ3F3bzl1a3dldjcifQ.O0kAhVcu1M_ujwu4NxmOXA";

const map = new mapboxgl.Map({
  container: "map",
  style: "mapbox://styles/agariapparel/cmkf5d8pj004c01sdaw4qfhzt",
  center: [116, -2.7],
  zoom: 3
});
  map.on("load", () => {
    console.log("Map loaded");
  
    // ðŸ”¥ HIDE MARKER & LABEL BAWAAN MAPBOX
    if (map.getLayer("Icon")) {
      map.setLayoutProperty("Icon", "visibility", "none");
    }
  
    if (map.getLayer("Label")) {
      map.setLayoutProperty("Label", "visibility", "visible");
    }
});

// ===== GEOLOCATION =====
if (navigator.geolocation) {
  navigator.geolocation.getCurrentPosition(
    pos => {
      map.flyTo({
        center: [pos.coords.longitude, pos.coords.latitude],
        zoom: 5,
        essential: true
      });
    }
  );
}

  function openBottomSheet(feature) {
    const p = feature.properties;
  
    const sheet = document.getElementById("agari-sheet");
  
    const nameEl = document.getElementById("sheet-name");
    const addressEl = document.getElementById("sheet-address");
    const communityEl = document.getElementById("sheet-community");
    const courtsEl = document.getElementById("sheet-courts");
    const surfaceEl = document.getElementById("sheet-surface");
    const locationEl = document.getElementById("sheet-location");
  
    const statusEl = document.getElementById("sheet-status");
    const verifiedEl = document.getElementById("sheet-verified");
    const unverifiedEl = document.getElementById("sheet-unverified");
    const verifyCTA = document.getElementById("sheet-verify-cta");
    const directionsEl = document.getElementById("sheet-directions");
  
    nameEl.innerText = p.name || "";
    addressEl.innerText = p.address || "";
    communityEl.innerText = p.community || "-";
    courtsEl.innerText = p.courts || "-";
    surfaceEl.innerText = p.surface || "-";
    locationEl.innerText =
      (p.city || "") +
      (p.province ? ", " + p.province : "") +
      (p.country ? ", " + p.country : "");
  
    directionsEl.href = p.google_maps_url || "#";
  
    // ===== STATUS =====
    statusEl.style.display = "none";
    statusEl.className = "status-badge";
  
    if (p.status) {
      const s = p.status.toLowerCase();
      statusEl.innerText = p.status;
      statusEl.style.display = "inline-block";
  
      if (s === "active") statusEl.classList.add("status-active");
      if (s === "inactive" || s === "closed")
        statusEl.classList.add("status-inactive");
    }
  
    // ===== VERIFIED =====
    verifiedEl.style.display = "none";
    unverifiedEl.style.display = "none";
    verifyCTA.style.display = "none";
  
    const isVerified =
      p.verified === true ||
      p.verified === "true" ||
      p.verified === "TRUE";
    
    if (isVerified) {
      verifiedEl.style.display = "inline-block";
    } else {
      unverifiedEl.style.display = "inline-block";
      verifyCTA.style.display = "inline";
    }
    
    sheet.classList.add("show");
    document.body.classList.add("sheet-open");
  }


// ===== LOAD GEOJSON =====
fetch("./public/gateball-fields.geojson")
  .then(res => res.json())
  .then(data => {
    console.log("TOTAL FEATURES:", data.features.length);

   data.features.forEach((feature) => {
    const el = document.createElement("div");
    el.className = "agari-marker";
  
    // hover cursor
    el.addEventListener("mouseenter", () => {
      map.getCanvas().style.cursor = "pointer";
    });
  
    el.addEventListener("mouseleave", () => {
      map.getCanvas().style.cursor = "";
    });
  
    const marker = new mapboxgl.Marker({
      element: el,
      anchor: "bottom"
    })
      .setLngLat(feature.geometry.coordinates)
      .addTo(map);
  
    el.addEventListener("click", (e) => {
      e.stopPropagation();
  
      map.flyTo({
        center: feature.geometry.coordinates,
        zoom: Math.max(map.getZoom(), 12),
        speed: 0.8,
        offset: [0, -200],
        essential: true
      });
  
      openBottomSheet(feature);
    });
  });
});
  
  // ðŸ‘‰ klik area map kosong â†’ tutup sheet
  map.on("click", () => {
    document.getElementById("agari-sheet").classList.remove("show");
    document.body.classList.remove("sheet-open");
  });

</script>

</body>
</html>
